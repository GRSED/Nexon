# 이벤트 서버

이벤트 및 보상 관리를 위한 백엔드 서버입니다.

## 기술 스택

- Node.js 18
- NestJS
- MongoDB
- JWT Authentication
- Docker + docker-compose
- TypeScript

## 서버 구성 및 주요 기능

### event-server
**이벤트 관리**
- 이벤트 생성/수정
  - 제목, 시작/종료 시간, 상태, 목표 설정
- 이벤트 목록 조회
  - 일반 사용자: active 상태의 이벤트만 조회
  - 관리자/감사자/운영자: 모든 상태의 이벤트 조회
- 이벤트 상세 조회
- 이벤트 상태 관리
  - active: 활성화된 이벤트
  - inactive: 비활성화된 이벤트

**리워드 관리**
- 리워드 생성/수정/삭제
  - 포인트 또는 드로우 카운트 지급
- 리워드 요청 및 처리
  - 리워드 요청 가능
  - 자동 검증 및 처리
- 리워드 요청 목록 조회

### gateway-server
**모든 요청에 대한 라우팅 수행**
**JWT 검증 및 역할 검사**
- 역할 기반 접근 제어 (RBAC)
  - user: 일반 사용자
  - operator: 운영자
  - auditor: 감사자
  - admin: 관리자
- JWT 기반 인증

### auth-server
**사용자 관리**
- 회원가입
  - 이메일, 비밀번호 기반 회원가입
  - 기본 역할: user
- 로그인/로그아웃
  - JWT 발급
  - 액세스 토큰과 리프레시 토큰 발급
- 토큰 갱신
  - 리프레시 토큰을 통한 액세스 토큰 갱신




## API 엔드포인트

- http://localhost:3000
- swagger-spec.json 파일 참조

## 설치 및 실행

1. Docker 설치
2. root 폴더에서 Docker 컨테이너 실행
```bash
docker compose up -build
```

## 기타

- 몽고DB는 데이터 접근의 용이성을 위해서 로컬에 저장합니다.
- 이벤트는 삭제 대신에 inactive 시키는 형태로 생각했습니다. 유저는 소프트삭제를 고려해서 스키마를 작성했지만 현재 유저삭제기능은 존재하지 않습니다.
- 리워드 정보가 등록되지 않은 이벤트에 대해서 보상을 요청할 경우 이력을 남기지 않습니다.(에러처리)
- 유저가입시 기본 역할을 user로 정의했고 역할수정은 admin만 가능합니다. 다만 테스트를 위해서 회원가입시 역할을 설정할 수 있습니다. 운영에 들어간다면 가입시 역할 설정은 삭제해야 합니다.
- 크지 않은 구조의 테스트 프로젝트였기 때문에 서버별로 DB를 나누지 않고 컬렉션으로만 구분해 주었습니다. 마찬가지로 형상관리도 루트에서만 해주고 있습니다.
- 토큰에는 유저의 역할이 기록되어 있습니다. 역할 업데이트시 기존 토큰을 그대로 사용할 경우 문제가 될 수 있지만 기본 역할이 유저이며 액세스토큰의 유지시간을 5분으로 짧게 설정하는 것으로 대응했습니다.
- 토큰에는 version이 포함되어 있습니다. 현재는 구현되어 있지 않지만 버전관리를 통해 기존 토큰을 만료처리할 때 사용할 수 있습니다(ex. Redis등). 이를 통해 유저의 역할변경에도 더욱 안전하게 대응할 수 있습니다.